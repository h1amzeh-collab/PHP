create database e_commerce;

/* Users Table: 
   Stores personal information, credentials, and access levels for all platform users.
   Includes unique identifiers, registration timestamps, and user roles.
*/

CREATE TABLE Users (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    email VARCHAR(150) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    registration_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    gender ENUM('Male', 'Female'),
    user_type ENUM('Admin', 'Customer') DEFAULT 'Customer'
);

/* Addresses Table:
   Stores multiple shipping and billing addresses for users.
   Linked to the Users table through a foreign key relationship.
*/

CREATE TABLE Addresses (
    address_id INT PRIMARY KEY AUTO_INCREMENT,
    address_name VARCHAR(50) NOT NULL, -- e.g., 'Home', 'Work'
    country VARCHAR(100) NOT NULL,
    city VARCHAR(100) NOT NULL,
    street VARCHAR(150) NOT NULL,
    building_number VARCHAR(20),
    phone_number VARCHAR(20) NOT NULL,
    user_id INT, -- Foreign Key
    
    -- Linking the address to a specific user
    CONSTRAINT fk_user_address 
    FOREIGN KEY (user_id) REFERENCES Users(user_id) 
    ON DELETE CASCADE
);

/* Categories Table: 
   Defines product groupings such as Electronics, Clothing, or Home Goods.
   Includes a name, creation date, and a reference to a category image.
*/

CREATE TABLE Categories (
    category_id INT PRIMARY KEY AUTO_INCREMENT,
    category_name VARCHAR(100) NOT NULL UNIQUE,
    category_image VARCHAR(255), -- Stores the file path or URL of the image
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


/* Products Table: 
   Stores details for all items available in the shop.
   Linked to Categories and includes stock levels, pricing, 
   visibility status, and warranty information.
*/

CREATE TABLE Products (
    product_id INT PRIMARY KEY AUTO_INCREMENT,
    product_name VARCHAR(150) NOT NULL,
    price DECIMAL(10, 2) NOT NULL, -- Supports prices like 999.99
    stock_quantity INT DEFAULT 0,
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE, -- Represents "Is it displayed?"
    has_warranty BOOLEAN DEFAULT FALSE,
    warranty_duration VARCHAR(50), -- e.g., '1 Year', '24 Months'
    category_id INT,
    
    -- Linking product to its category
    CONSTRAINT fk_product_category 
    FOREIGN KEY (category_id) REFERENCES Categories(category_id)
    ON DELETE SET NULL
);

/* Orders Table: 
   Represents the main purchase record for a customer.
   Stores high-level data like total price, status, and shipping information.
*/

CREATE TABLE Orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    shipping_date DATE,
    shipping_address TEXT, -- Detailed location where the order will be sent
    total_quantity INT NOT NULL,
    total_price DECIMAL(12, 2) NOT NULL,
    order_status ENUM('Pending', 'Shipped', 'Delivered', 'Cancelled') DEFAULT 'Pending',
    
    CONSTRAINT fk_order_user 
    FOREIGN KEY (user_id) REFERENCES Users(user_id) 
ON DELETE CASCADE;

/* Order_Items Table (Sales Details): 
   A junction table that breaks down each order into individual products.
   Records the exact price and quantity of each item at the time of purchase.
*/

CREATE TABLE Order_Items (
    item_id INT PRIMARY KEY AUTO_INCREMENT,
    order_id INT,
    product_id INT,
    quantity INT NOT NULL,
    price_at_purchase DECIMAL(10, 2) NOT NULL,
    
    CONSTRAINT fk_item_order 
    FOREIGN KEY (order_id) REFERENCES Orders(order_id) ON DELETE CASCADE,
    
    CONSTRAINT fk_item_product 
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);

/* Reviews Table: 
   Stores customer ratings and complaints for specific products.
   Links Users to Products and records the quality of their experience.
*/

CREATE TABLE Reviews (
    review_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    product_id INT,
    rating INT CHECK (rating BETWEEN 1 AND 5), -- Ensures rating is between 1 and 5
    comment_text TEXT,
    review_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT fk_review_user 
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE,
    
    CONSTRAINT fk_review_product 
    FOREIGN KEY (product_id) REFERENCES Products(product_id) ON DELETE CASCADE
);

/* Wishlist Table: 
   Acts as a junction table to store products that users are interested in.
   Allows for tracking potential future sales and user preferences.
*/

CREATE TABLE Wishlist (
    wishlist_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    product_id INT,
    added_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT fk_wishlist_user 
    FOREIGN KEY (user_id) REFERENCES Users(user_id) ON DELETE CASCADE,
    
    CONSTRAINT fk_wishlist_product 
    FOREIGN KEY (product_id) REFERENCES Products(product_id) ON DELETE CASCADE
); 